<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√†i ƒë·∫∑t ESign</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #007AFF, #5856D6);
            border-radius: 20px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
        }
        h1 { color: #1d1d1f; margin-bottom: 10px; }
        p { color: #86868b; margin-bottom: 30px; }
        .btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        .btn:hover { background: #0056CC; transform: translateY(-2px); }
        .btn:active { transform: translateY(0); }
        .steps { text-align: left; margin-top: 30px; color: #666; font-size: 14px; }
        .step { margin-bottom: 10px; padding-left: 20px; position: relative; }
        .step:before { content: "‚úì"; position: absolute; left: 0; color: #007AFF; }
        .hidden { display: none; }
        .loading { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <div class="logo">üì±</div>
        <h1>C√†i ƒë·∫∑t ESign</h1>
        <p>·ª®ng d·ª•ng ƒë√£ ƒë∆∞·ª£c k√Ω h·ª£p l·ªá, s·∫µn s√†ng c√†i ƒë·∫∑t tr√™n iOS</p>
        <button class="btn" id="installBtn">C√†i ƒë·∫∑t ngay</button>
        
        <div class="steps">
            <div class="step">K√Ω ch·ª©ng ch·ªâ h·ª£p l·ªá</div>
            <div class="step">C√†i ƒë·∫∑t OTA tr·ª±c ti·∫øp</div>
            <div class="step">Tin c·∫≠y nh√† ph√°t tri·ªÉn</div>
        </div>
    </div>

    <div class="container hidden" id="loadingContainer">
        <div class="logo loading">‚è≥</div>
        <h1>ƒêang c√†i ƒë·∫∑t...</h1>
        <p id="statusText">ƒêang k·∫øt n·ªëi v·ªõi m√°y ch·ªß</p>
        <div class="steps">
            <div id="step1">‚úì ƒêang t·∫£i ·ª©ng d·ª•ng...</div>
            <div id="step2">Ch·ªù x√°c nh·∫≠n c√†i ƒë·∫∑t...</div>
            <div id="step3">Ho√†n t·∫•t thi·∫øt l·∫≠p...</div>
        </div>
    </div>

    <script>
        // C·∫§U H√åNH - QUAN TR·ªåNG!
        const CONFIG = {
            // URL file IPA - D√ôNG RAW.GITHACK.COM T·ªêT H∆†N
            ipaUrl: 'https://rawcdn.githack.com/phnamm-dev/server-resources/refs/heads/main/file/namserver-ESign-signed.ipa',
            
            // BUNDLE ID ƒê√öNG t·ª´ file IPA
            bundleId: 'nya.asami.ksign',
            
            // T√™n hi·ªÉn th·ªã
            appName: 'ESign',
            appVersion: '1.0'
        };

        // C√°c ph·∫ßn t·ª≠ DOM
        const mainContainer = document.getElementById('mainContainer');
        const loadingContainer = document.getElementById('loadingContainer');
        const installBtn = document.getElementById('installBtn');
        const statusText = document.getElementById('statusText');
        
        // C·∫≠p nh·∫≠t tr·∫°ng th√°i
        function updateStatus(text, step = 0) {
            statusText.textContent = text;
            
            // C·∫≠p nh·∫≠t c√°c b∆∞·ªõc
            const steps = ['step1', 'step2', 'step3'];
            steps.forEach((id, index) => {
                const el = document.getElementById(id);
                if (index < step) {
                    el.innerHTML = '‚úì ' + el.textContent.replace('‚úì ', '');
                    el.style.color = '#007AFF';
                } else if (index === step) {
                    el.innerHTML = '‚è≥ ' + el.textContent.replace(/[‚úì‚è≥] /, '');
                    el.style.color = '#1d1d1f';
                } else {
                    el.innerHTML = el.textContent.replace(/[‚úì‚è≥] /, '');
                    el.style.color = '#86868b';
                }
            });
        }

        // T·∫°o manifest.plist ƒë∆°n gi·∫£n
        function createManifestPlist() {
            return `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>items</key>
    <array>
        <dict>
            <key>assets</key>
            <array>
                <dict>
                    <key>kind</key>
                    <string>software-package</string>
                    <key>url</key>
                    <string>${CONFIG.ipaUrl}</string>
                </dict>
                <dict>
                    <key>kind</key>
                    <string>display-image</string>
                    <key>url</key>
                    <string>https://via.placeholder.com/120x120/007AFF/FFFFFF?text=ES</string>
                </dict>
            </array>
            <key>metadata</key>
            <dict>
                <key>bundle-identifier</key>
                <string>${CONFIG.bundleId}</string>
                <key>bundle-version</key>
                <string>${CONFIG.appVersion}</string>
                <key>kind</key>
                <string>software</string>
                <key>title</key>
                <string>${CONFIG.appName}</string>
                <key>subtitle</key>
                <string>Signed App</string>
            </dict>
        </dict>
    </array>
</dict>
</plist>`;
        }

        // K√≠ch ho·∫°t c√†i ƒë·∫∑t
        async function startInstallation() {
            // Chuy·ªÉn sang m√†n h√¨nh loading
            mainContainer.classList.add('hidden');
            loadingContainer.classList.remove('hidden');
            
            updateStatus('ƒêang ki·ªÉm tra thi·∫øt b·ªã...', 0);
            
            // Ki·ªÉm tra iOS
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            if (!isIOS) {
                updateStatus('Vui l√≤ng m·ªü tr√™n iPhone/iPad', 0);
                setTimeout(() => {
                    alert('Vui l√≤ng m·ªü trang n√†y tr√™n iPhone ho·∫∑c iPad ƒë·ªÉ c√†i ƒë·∫∑t.');
                    window.location.href = 'https://support.apple.com/guide/iphone/install-apps-iph4d8d2a2d0/ios';
                }, 2000);
                return;
            }
            
            // B∆∞·ªõc 1: T·∫°o manifest
            updateStatus('ƒêang t·∫°o g√≥i c√†i ƒë·∫∑t...', 1);
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // B∆∞·ªõc 2: T·∫°o manifest URL
            const manifestContent = createManifestPlist();
            const manifestBlob = new Blob([manifestContent], { type: 'application/x-plist' });
            const manifestUrl = URL.createObjectURL(manifestBlob);
            
            // B∆∞·ªõc 3: K√≠ch ho·∫°t c√†i ƒë·∫∑t
            updateStatus('M·ªü tr√¨nh c√†i ƒë·∫∑t...', 2);
            
            // T·∫°o v√† k√≠ch ho·∫°t iframe
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = `itms-services://?action=download-manifest&url=${encodeURIComponent(manifestUrl)}`;
            document.body.appendChild(iframe);
            
            // M·ªü popup d·ª± ph√≤ng
            setTimeout(() => {
                const popup = window.open(
                    `itms-services://?action=download-manifest&url=${encodeURIComponent(manifestUrl)}`,
                    '_blank'
                );
                
                if (popup) {
                    // ƒê√≥ng popup sau 2 gi√¢y
                    setTimeout(() => {
                        try { popup.close(); } catch(e) {}
                    }, 2000);
                }
            }, 500);
            
            // B∆∞·ªõc 4: Ho√†n t·∫•t
            updateStatus('Ch·ªù x√°c nh·∫≠n tr√™n m√†n h√¨nh...', 3);
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            updateStatus('C√†i ƒë·∫∑t ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t!', 3);
            
            // H∆∞·ªõng d·∫´n ti·∫øp theo
            setTimeout(() => {
                alert('N·∫øu kh√¥ng th·∫•y tr√¨nh c√†i ƒë·∫∑t:\n1. Ki·ªÉm tra popup b·ªã ch·∫∑n\n2. M·ªü Safari Settings > Cho ph√©p Popups\n3. Th·ª≠ l·∫°i\n\nSau khi c√†i xong, v√†o C√†i ƒë·∫∑t > Chung > VPN & Qu·∫£n l√Ω thi·∫øt b·ªã > Tin c·∫≠y nh√† ph√°t tri·ªÉn.');
            }, 1000);
            
            // D·ªçn d·∫πp sau 10 gi√¢y
            setTimeout(() => {
                URL.revokeObjectURL(manifestUrl);
                iframe.remove();
            }, 10000);
        }

        // S·ª± ki·ªán click
        installBtn.addEventListener('click', startInstallation);
        
        // T·ª± ƒë·ªông ch·∫°y n·∫øu c√≥ tham s·ªë auto
        if (window.location.search.includes('auto=1')) {
            setTimeout(startInstallation, 1000);
        }
    </script>
</body>
</html>
